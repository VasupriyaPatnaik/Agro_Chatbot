<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üå± AgroBot - Crop Symptom Assistant</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #2c7a2c;
      --secondary-color: #4caf50;
      --light-color: #e8f5e9;
      --dark-color: #1b5e20;
      --bot-msg-color: #e8f5e9;
      --user-msg-color: #f0f7ff;
      --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      --error-color: #f44336;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f4f9f4 0%, #e3f2e3 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 85vh;
    }

    .header {
      background: var(--primary-color);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-content {
      flex: 1;
    }

    .header h1 {
      font-size: 1.8rem;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .header p {
      margin-top: 5px;
      opacity: 0.9;
      font-size: 0.9rem;
    }

    .clear-chat {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background 0.3s;
    }

    .clear-chat:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .language-select {
      margin-right: 10px;
      padding: 5px 8px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      max-width: 75%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
      position: relative;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .bot-message {
      align-self: flex-start;
      background: var(--bot-msg-color);
      border-bottom-left-radius: 4px;
    }

    .user-message {
      align-self: flex-end;
      background: var(--user-msg-color);
      border-bottom-right-radius: 4px;
    }

    .input-area {
      padding: 20px;
      background: white;
      border-top: 1px solid #eaeaea;
      display: flex;
      gap: 10px;
      position: relative;
    }

    .input-field {
      flex: 1;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s;
    }

    .input-field:focus {
      border-color: var(--secondary-color);
    }

    .input-field.error {
      border-color: var(--error-color);
    }

    .error-message {
      color: var(--error-color);
      font-size: 0.8rem;
      position: absolute;
      top: 5px;
      left: 30px;
    }

    .send-button {
      background: var(--primary-color);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .send-button:hover {
      background: var(--dark-color);
    }

    .send-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .diagnosis-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-top: 10px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary-color);
    }

    .diagnosis-card h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .diagnosis-card p {
      margin-bottom: 8px;
      line-height: 1.5;
    }

    .info-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.7rem;
      font-weight: bold;
      margin-right: 8px;
    }

    .severity-high {
      background-color: #ffebee;
      color: #d32f2f;
    }

    .severity-medium {
      background-color: #fff8e1;
      color: #ff8f00;
    }

    .severity-low {
      background-color: #e8f5e9;
      color: #388e3c;
    }

    .typing-indicator {
      display: inline-flex;
      align-items: center;
      background: var(--bot-msg-color);
      padding: 12px 16px;
      border-radius: 18px;
      border-bottom-left-radius: 4px;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 50%;
      margin: 0 3px;
      animation: typingAnimation 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingAnimation {
      0%,
      60%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-5px);
      }
    }

    .suggestion-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .suggestion-chip {
      background: white;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
      padding: 8px 15px;
      border-radius: 18px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .suggestion-chip:hover {
      background: var(--primary-color);
      color: white;
    }

    @media (max-width: 768px) {
      .container {
        height: 92vh;
        border-radius: 15px;
      }

      .message {
        max-width: 85%;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .input-area {
        flex-direction: column;
      }

      .send-button {
        align-self: flex-end;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <h1><i class="fas fa-robot"></i> AgroBot Assistant</h1>
        <p id="headerSubtitle">Your AI-powered crop health diagnosis expert</p>
      </div>
      <div>
        <select class="language-select" id="languageSelect" onchange="changeLanguage()">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>
        <button class="clear-chat" onclick="clearChat()">
          <i class="fas fa-broom"></i> <span id="clearText">Clear Chat</span>
        </button>
      </div>
    </div>

    <div class="chat-container" id="chatContainer"></div>

    <form method="POST" class="input-area" id="diagnosisForm">
      <input type="text" name="crop" class="input-field" placeholder="Enter crop (e.g., Tomato)" required id="cropInput">
      <input type="text" name="symptom" class="input-field" placeholder="Describe symptoms (e.g., yellow leaves)" required id="symptomInput">
      <button type="submit" class="send-button" id="submitButton">
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>
  </div>

  <script>
    let userLanguage = 'en';

    const translations = {
      en: {
        greeting: "Hello! I'm AgroBot, your crop health assistant. I can help diagnose plant issues based on symptoms you describe.",
        placeholders: { crop: "Enter crop (e.g., Tomato)", symptom: "Describe symptoms (e.g., yellow leaves)" },
        buttons: { clear: "Clear Chat" },
        headerSubtitle: "Your AI-powered crop health diagnosis expert",
        suggestions: { tomato: "Tomato: Yellow leaves", rice: "Rice: Brown spots", maize: "Maize: Yellow stripes" },
        followUp: "Is there anything else you'd like to know about your crops?",
        emptyFields: "Please fill both fields",
        labels: {
          possible_issue: "Possible Issue",
          season: "Season/Risk Period",
          prevention: "Prevention",
          treatment: "Treatment",
          organic_treatment: "Organic Treatment",
          severity: "Severity"
        }
      },
      hi: {
        greeting: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç AgroBot ‡§π‡•Ç‡§Å, ‡§Ü‡§™‡§ï‡§æ ‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§Æ‡•à‡§Ç ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§®‡§ø‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§",
        placeholders: { crop: "‡§´‡§∏‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§ü‡§Æ‡§æ‡§ü‡§∞)", symptom: "‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§¶‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§™‡•Ä‡§≤‡•á ‡§™‡§§‡•ç‡§§‡•á)" },
        buttons: { clear: "‡§ö‡•à‡§ü ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç" },
        headerSubtitle: "‡§Ü‡§™‡§ï‡•á AI-‡§™‡§æ‡§µ‡§∞‡•ç‡§° ‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§®‡§ø‡§¶‡§æ‡§® ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û",
        suggestions: { tomato: "‡§ü‡§Æ‡§æ‡§ü‡§∞: ‡§™‡•Ä‡§≤‡•á ‡§™‡§§‡•ç‡§§‡•á", rice: "‡§ö‡§æ‡§µ‡§≤: ‡§≠‡•Ç‡§∞‡•á ‡§ß‡§¨‡•ç‡§¨‡•á", maize: "‡§Æ‡§ï‡§à: ‡§™‡•Ä‡§≤‡•Ä ‡§ß‡§æ‡§∞‡§ø‡§Ø‡§æ‡§Å" },
        followUp: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§ú‡§æ‡§®‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
        emptyFields: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç",
        labels: {
          possible_issue: "‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ",
          season: "‡§Æ‡•å‡§∏‡§Æ/‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§Ö‡§µ‡§ß‡§ø",
          prevention: "‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ",
          treatment: "‡§â‡§™‡§ö‡§æ‡§∞",
          organic_treatment: "‡§ú‡•à‡§µ‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞",
          severity: "‡§§‡•Ä‡§µ‡•ç‡§∞‡§§‡§æ"
        }
      },
      te: {
        greeting: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å AgroBot, ‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡±Å. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡±á ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤ ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞®‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞®‡±á‡∞®‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å.",
        placeholders: { crop: "‡∞™‡∞Ç‡∞ü‡∞®‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ., ‡∞ü‡∞Æ‡±ã‡∞ü‡∞æ)", symptom: "‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ., ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞Ü‡∞ï‡±Å)" },
        buttons: { clear: "‡∞ö‡∞æ‡∞ü‡±ç ‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" },
        headerSubtitle: "‡∞Æ‡±Ä AI-‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞≤ ‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£ ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞°‡±Å",
        suggestions: { tomato: "‡∞ü‡∞Æ‡±ã‡∞ü‡∞æ: ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞Ü‡∞ï‡±Å‡∞≤‡±Å", rice: "‡∞Ö‡∞®‡±ç‡∞®‡∞Ç: ‡∞ó‡±ã‡∞ß‡±Å‡∞Æ ‡∞Æ‡∞ö‡±ç‡∞ö‡∞≤‡±Å", maize: "‡∞Æ‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®: ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞∞‡±á‡∞ñ‡∞≤‡±Å" },
        followUp: "‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü‡∞≤ ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡∞∞‡±á‡∞¶‡±à‡∞®‡∞æ ‡∞§‡±Ü‡∞≤‡±Å‡∞∏‡±Å‡∞ï‡±ã‡∞µ‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?",
        emptyFields: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞∞‡±Ü‡∞Ç‡∞°‡±Å ‡∞´‡±Ä‡∞≤‡±ç‡∞°‡±ç‚Äå‡∞≤‡±Å ‡∞ï‡±Ç‡∞°‡∞æ ‡∞®‡∞ø‡∞Ç‡∞™‡∞Ç‡∞°‡∞ø",
        labels: {
          possible_issue: "‡∞∏‡∞Ç‡∞≠‡∞æ‡∞µ‡±ç‡∞Ø ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø",
          season: "‡∞ã‡∞§‡±Å‡∞µ‡±Å/‡∞ú‡±ã‡§ñ‡§ø‡§Æ ‡∞ï‡∞æ‡∞≤‡∞Ç",
          prevention: "‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£",
          treatment: "‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏",
          organic_treatment: "‡∞∏‡±á‡∞Ç‡∞¶‡±ç‡∞∞‡±Ä‡∞Ø ‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏",
          severity: "‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§"
        }
      }
    };

    function addMessage(text, isUser = false) {
      const chatContainer = document.getElementById('chatContainer');
      const messageDiv = document.createElement('div');
      messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
      messageDiv.innerHTML = text;
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTypingIndicator() {
      const chatContainer = document.getElementById('chatContainer');
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message bot-message';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = '<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
      chatContainer.appendChild(typingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typingIndicator');
      if (typingIndicator) typingIndicator.remove();
    }

    function fillSuggestion(crop, symptom) {
      document.getElementById('cropInput').value = crop;
      document.getElementById('symptomInput').value = symptom;
    }

    function updateUITexts(lang) {
      const t = translations[lang];
      document.getElementById('cropInput').placeholder = t.placeholders.crop;
      document.getElementById('symptomInput').placeholder = t.placeholders.symptom;
      document.getElementById('clearText').textContent = t.buttons.clear;
      document.getElementById('headerSubtitle').textContent = t.headerSubtitle;

      const suggestionChipsHTML = `<div class="suggestion-chips">
        <div class="suggestion-chip" onclick="fillSuggestion('${t.suggestions.tomato.split(':')[0]}','${t.suggestions.tomato.split(':')[1].trim()}')">${t.suggestions.tomato}</div>
        <div class="suggestion-chip" onclick="fillSuggestion('${t.suggestions.rice.split(':')[0]}','${t.suggestions.rice.split(':')[1].trim()}')">${t.suggestions.rice}</div>
        <div class="suggestion-chip" onclick="fillSuggestion('${t.suggestions.maize.split(':')[0]}','${t.suggestions.maize.split(':')[1].trim()}')">${t.suggestions.maize}</div>
      </div>`;
      return suggestionChipsHTML;
    }

    function showInitialBotMessage() {
      const t = translations[userLanguage];
      const suggestionHTML = updateUITexts(userLanguage);
      addMessage(`<p>${t.greeting}</p>${suggestionHTML}`);
    }

    function clearChat() {
      document.getElementById('chatContainer').innerHTML = '';
      showInitialBotMessage();
    }

    function changeLanguage() {
      userLanguage = document.getElementById('languageSelect').value;
      clearChat();
    }

    showInitialBotMessage();

    const form = document.getElementById('diagnosisForm');
    const submitButton = document.getElementById('submitButton');

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      let crop = document.getElementById('cropInput').value.trim();
      let symptom = document.getElementById('symptomInput').value.trim();

      if (!crop || !symptom) {
        addMessage(translations[userLanguage].emptyFields, false);
        return;
      }

      addMessage(`<strong>Crop:</strong> ${crop}<br><strong>Symptom:</strong> ${symptom}`, true);
      showTypingIndicator();
      submitButton.disabled = true;

      try {
        const response = await fetch('/diagnose', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ crop, symptom, lang: userLanguage })
        });

        hideTypingIndicator();

        if (response.ok) {
          const data = await response.json();

          const fields = {
            possible_issue: data.possible_issue || 'N/A',
            season: data.season || 'N/A',
            prevention: data.prevention || 'N/A',
            treatment: data.treatment || 'N/A',
            organic_treatment: data.organic_treatment || 'N/A',
            severity: data.severity || 'Medium'
          };

          const translatedFields = fields; // If backend returns localized text, else call translateAllFields(fields, userLanguage)

          let severityClass = 'severity-medium';
          if (translatedFields.severity.toLowerCase().includes('high')) severityClass = 'severity-high';
          else if (translatedFields.severity.toLowerCase().includes('low')) severityClass = 'severity-low';

          const labels = translations[userLanguage].labels;

          const diagnosisCard = `<div class="diagnosis-card">
            <h3><i class="fas fa-diagnoses"></i> ${labels.severity}: <span class="info-badge ${severityClass}">${translatedFields.severity}</span></h3>
            <p><strong>${labels.possible_issue}:</strong> ${translatedFields.possible_issue}</p>
            <p><strong>üå§Ô∏è ${labels.season}:</strong> ${translatedFields.season}</p>
            <p><strong>‚úÖ ${labels.prevention}:</strong> ${translatedFields.prevention}</p>
            <p><strong>üíä ${labels.treatment}:</strong> ${translatedFields.treatment}</p>
            <p><strong>üåø ${labels.organic_treatment}:</strong> ${translatedFields.organic_treatment}</p>
          </div>`;

          addMessage(diagnosisCard);

          setTimeout(() => {
            showTypingIndicator();
            setTimeout(() => {
              hideTypingIndicator();
              addMessage(translations[userLanguage].followUp);
            }, 1000);
          }, 500);
        } else {
          const errData = await response.json();
          addMessage(errData.message || 'No diagnosis found.', false);
        }

      } catch (error) {
        hideTypingIndicator();
        addMessage("Error processing your request.", false);
        console.error(error);
      } finally {
        submitButton.disabled = false;
      }
    });
  </script>
</body>

</html>
