<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>üå± AgroBot - Crop Symptom Assistant</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary-color: #2c7a2c;
      --secondary-color: #4caf50;
      --light-color: #e8f5e9;
      --dark-color: #1b5e20;
      --bot-msg-color: #e8f5e9;
      --user-msg-color: #f0f7ff;
      --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      --error-color: #f44336;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif
    }

    body {
      background: linear-gradient(135deg, #f4f9f4 0%, #e3f2e3 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center
    }

    .container {
      width: 100%;
      max-width: 900px;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      height: 85vh
    }

    .header {
      background: var(--primary-color);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .header h1 {
      font-size: 1.8rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px
    }

    .clear-chat {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: background 0.3s
    }

    .clear-chat:hover {
      background: rgba(255, 255, 255, 0.3)
    }

    .language-select {
      margin-right: 10px;
      padding: 5px 8px;
      border-radius: 8px;
      border: none;
      cursor: pointer
    }

    .chat-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      gap: 15px
    }

    .message {
      max-width: 75%;
      padding: 12px 16px;
      border-radius: 18px;
      line-height: 1.5;
      position: relative;
      animation: fadeIn 0.3s ease
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .bot-message {
      align-self: flex-start;
      background: var(--bot-msg-color);
      border-bottom-left-radius: 4px
    }

    .user-message {
      align-self: flex-end;
      background: var(--user-msg-color);
      border-bottom-right-radius: 4px
    }

    .input-area {
      padding: 20px;
      background: white;
      border-top: 1px solid #eaeaea;
      display: flex;
      gap: 10px;
      position: relative
    }

    .input-field {
      flex: 1;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.3s
    }

    .input-field:focus {
      border-color: var(--secondary-color)
    }

    .send-button {
      background: var(--primary-color);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s
    }

    .send-button:hover {
      background: var(--dark-color)
    }

    .send-button:disabled {
      background: #ccc;
      cursor: not-allowed
    }

    .send-button.processing {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .diagnosis-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-top: 10px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary-color)
    }

    .advice-section {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 3px solid var(--primary-color);
    }

    .advice-title {
      font-weight: 600;
      color: var(--dark-color);
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .typing-indicator {
      display: inline-flex;
      align-items: center;
      background: var(--bot-msg-color);
      padding: 12px 16px;
      border-radius: 18px;
      border-bottom-left-radius: 4px
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 50%;
      margin: 0 3px;
      animation: typingAnimation 1.4s infinite
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.2s
    }

    .typing-dot:nth-child(3) {
      animation-delay: 0.4s
    }

    @keyframes typingAnimation {

      0%,
      60%,
      100% {
        transform: translateY(0)
      }

      30% {
        transform: translateY(-5px)
      }
    }

    .suggestion-boxes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 10px
    }

    .suggestion-box {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border: 1px solid #dee2e6;
      border-radius: 12px;
      padding: 12px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      text-align: center;
      position: relative;
      overflow: hidden
    }

    .suggestion-box:hover {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3)
    }

    .image-upload-container {
      background: white;
      padding: 15px;
      border-top: 1px solid #eaeaea;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px
    }

    .image-preview {
      width: 180px;
      height: 180px;
      border-radius: 10px;
      border: 2px dashed #ccc;
      object-fit: cover;
      display: none
    }

    .upload-label {
      background: var(--primary-color);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 0.3s
    }

    .upload-label:hover {
      background: var(--dark-color)
    }

    #imageInput {
      display: none
    }

    .predict-btn {
      background: var(--secondary-color);
      color: white;
      padding: 8px 15px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s
    }

    .predict-btn:hover {
      background: var(--dark-color)
    }

    .predict-btn:disabled {
      background: #ccc;
      cursor: not-allowed
    }

    .predict-btn.processing {
      animation: pulse 1.5s infinite;
    }

    /* Better scrollbar */
    .chat-container::-webkit-scrollbar {
      width: 6px;
    }

    .chat-container::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    .chat-container::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 3px;
    }

    .success-message {
      border-left: 4px solid #4caf50;
    }

    .error-message {
      border-left: 4px solid #f44336;
    }

    @media (max-width:768px) {
      .container {
        height: 92vh;
        border-radius: 15px
      }

      .message {
        max-width: 85%
      }

      .header h1 {
        font-size: 1.5rem
      }

      .input-area {
        flex-direction: column
      }

      .suggestion-boxes {
        grid-template-columns: 1fr
      }

      .suggestion-box {
        font-size: 0.8rem;
        padding: 10px 12px
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="header-content">
        <h1><i class="fas fa-robot"></i> AgroBot Assistant</h1>
        <p id="headerSubtitle"></p>
      </div>
      <div>
        <select class="language-select" id="languageSelect" onchange="changeLanguage()">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
          <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
        </select>
        <button class="clear-chat" onclick="clearChat()">
          <i class="fas fa-broom"></i> <span id="clearText"></span>
        </button>
      </div>
    </div>

    <div class="chat-container" id="chatContainer"></div>

    <div class="suggestions-container" id="suggestionsContainer">
      <div class="suggestion-boxes" id="suggestionBoxes"></div>
    </div>

    <form class="input-area" id="diagnosisForm">
      <input type="text" name="text" class="input-field" placeholder="" required id="userInput">
      <button type="submit" class="send-button" id="submitButton">
        <i class="fas fa-paper-plane"></i>
      </button>
    </form>

    <div class="image-upload-container">
      <label for="imageInput" class="upload-label">
        <i class="fas fa-upload"></i> <span id="uploadText">Upload Crop Image</span>
      </label>
      <input type="file" id="imageInput" accept="image/*" />
      <img id="imagePreview" class="image-preview" alt="Preview" />
      <button id="predictBtn" class="predict-btn" disabled>
        <span id="predictText">Predict from Image</span>
      </button>
    </div>
  </div>

  <script>
    let userLanguage = 'en';

    const translations = {
      en: {
        greeting: "Hello! I'm AgroBot, your crop health assistant. I can help diagnose plant issues based on symptoms you describe or images you upload.",
        placeholders: { symptom: "Describe your crop issue (e.g., my tomato plants have yellow leaves)" },
        buttons: { clear: "Clear Chat" },
        headerSubtitle: "Your AI-powered crop health diagnosis expert",
        followUp: "Is there anything else you'd like to know about your crops?",
        emptyFields: "Please describe your crop issue",
        upload: "Upload Crop Image",
        predict: "Predict from Image",
        processing: "Processing...",
        examplePhrases: "Try describing issues like",
        example1: "My tomato plants have yellow leaves",
        example2: "Brown spots on wheat leaves",
        imageUploaded: "üì∏ Image uploaded, analyzing crop health...",
        errorProcessing: "‚ùå Error processing your request. Please try again.",
        errorImage: "‚ùå Error processing image. Please try again.",
        unexpectedError: "Unexpected response format from server.",
        suggestions: [
          "Tomato: yellow leaves with brown spots",
          "Rice: white powdery substance on leaves", 
          "Wheat: orange pustules on stems",
          "Corn: grayish-white lesions on leaves"
        ],
        diagnosis: {
          basedOnSymptoms: "Based on the symptoms you described",
          forCrop: "for your {crop} crop",
          atLocation: "at {location}",
          mightBeAffected: "it might be affected by {disease}",
          severity: "Severity",
          recommendedActions: "Recommended Actions",
          prevention: "Prevention",
          treatment: "Treatment",
          organicOptions: "Organic Treatment",
          noDetailedAdvice: "No detailed advice is available",
          genericCrop: "crop",
          information: "Information",
          consultExperts: "Please consult with local agricultural experts for specific guidance.",
          genericDisease: "a plant disease"
        },
        userInputPrefix: {
          my: "My",
          plants: "plants have",
          have: "have"
        }
      },
      hi: {
        greeting: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç AgroBot ‡§π‡•Ç‡§Å, ‡§Ü‡§™‡§ï‡§æ ‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§Æ‡•à‡§Ç ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§Ø‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡•Ä ‡§ó‡§à ‡§õ‡§µ‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§®‡§ø‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§",
        placeholders: { symptom: "‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç (‡§ú‡•à‡§∏‡•á, ‡§Æ‡•á‡§∞‡•á ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§ï‡•á ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å ‡§™‡•Ä‡§≤‡•Ä ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡§Ç)" },
        buttons: { clear: "‡§ö‡•à‡§ü ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç" },
        headerSubtitle: "‡§Ü‡§™‡§ï‡•á AI-‡§™‡§æ‡§µ‡§∞‡•ç‡§° ‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§®‡§ø‡§¶‡§æ‡§® ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û",
        followUp: "‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§ú‡§æ‡§®‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?",
        emptyFields: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤ ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç",
        upload: "‡§´‡§∏‡§≤ ‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
        predict: "‡§õ‡§µ‡§ø ‡§∏‡•á ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‡§ï‡§∞‡•á‡§Ç",
        processing: "‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£...",
        examplePhrases: "‡§á‡§∏ ‡§§‡§∞‡§π ‡§ï‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç",
        example1: "‡§Æ‡•á‡§∞‡•á ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§ï‡•á ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å ‡§™‡•Ä‡§≤‡•Ä ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡§Ç",
        example2: "‡§ó‡•á‡§π‡•Ç‡§Ç ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§≠‡•Ç‡§∞‡•á ‡§ß‡§¨‡•ç‡§¨‡•á",
        imageUploaded: "üì∏ ‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡•Ä ‡§ó‡§à, ‡§´‡§∏‡§≤ ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
        errorProcessing: "‚ùå ‡§Ü‡§™‡§ï‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡•ã ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        errorImage: "‚ùå ‡§õ‡§µ‡§ø ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        unexpectedError: "‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§Ö‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§∂‡§ø‡§§ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™‡•§",
        suggestions: [
          "‡§ü‡§Æ‡§æ‡§ü‡§∞: ‡§≠‡•Ç‡§∞‡•á ‡§ß‡§¨‡•ç‡§¨‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Å",
          "‡§ö‡§æ‡§µ‡§≤: ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§∏‡§´‡•á‡§¶ ‡§™‡§æ‡§â‡§°‡§∞ ‡§ú‡•à‡§∏‡§æ ‡§™‡§¶‡§æ‡§∞‡•ç‡§•",
          "‡§ó‡•á‡§π‡•Ç‡§Ç: ‡§§‡§®‡•ã‡§Ç ‡§™‡§∞ ‡§®‡§æ‡§∞‡§Ç‡§ó‡•Ä ‡§´‡•Å‡§Ç‡§∏‡§ø‡§Ø‡§æ‡§Ç",
          "‡§Æ‡§ï‡•ç‡§ï‡§æ: ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§™‡§∞ ‡§≠‡•Ç‡§∞‡•á-‡§∏‡§´‡•á‡§¶ ‡§ò‡§æ‡§µ"
        ],
        diagnosis: {
          basedOnSymptoms: "‡§Ü‡§™‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¨‡§§‡§æ‡§è ‡§ó‡§è ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞",
          forCrop: "‡§Ü‡§™‡§ï‡•Ä {crop} ‡§´‡§∏‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è",
          atLocation: "{location} ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡§∞",
          mightBeAffected: "‡§Ø‡§π {disease} ‡§∏‡•á ‡§™‡•ç‡§∞‡§≠‡§æ‡§µ‡§ø‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à",
          severity: "‡§ó‡§Ç‡§≠‡•Ä‡§∞‡§§‡§æ",
          recommendedActions: "‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§ó‡§à ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à",
          prevention: "‡§∞‡•ã‡§ï‡§•‡§æ‡§Æ",
          treatment: "‡§â‡§™‡§ö‡§æ‡§∞",
          organicOptions: "‡§ú‡•à‡§µ‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞",
          noDetailedAdvice: "‡§ï‡•ã‡§à ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§∏‡§≤‡§æ‡§π ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à",
          genericCrop: "‡§´‡§∏‡§≤",
          information: "‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
          consultExperts: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û‡•ã‡§Ç ‡§∏‡•á ‡§™‡§∞‡§æ‡§Æ‡§∞‡•ç‡§∂ ‡§≤‡•á‡§Ç‡•§",
          genericDisease: "‡§è‡§ï ‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä"
        },
        userInputPrefix: {
          my: "‡§Æ‡•á‡§∞‡•á",
          plants: "‡§™‡•å‡§ß‡•ã‡§Ç",
          have: "‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç"
        }
      },
      te: {
        greeting: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å AgroBot, ‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡±Å. ‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡±á ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞≤ ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞®‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞®‡±á‡∞®‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å.",
        placeholders: { symptom: "‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø (‡∞â‡∞¶‡∞æ: ‡∞®‡∞æ ‡∞ü‡∞Æ‡∞æ‡∞ü‡∞æ ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞Ü‡∞ï‡±Å‡∞≤‡±Å ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞∞‡∞Ç‡∞ó‡±Å‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø)" },
        buttons: { clear: "‡∞ö‡∞æ‡∞ü‡±ç ‡∞ï‡±ç‡∞≤‡∞ø‡∞Ø‡∞∞‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" },
        headerSubtitle: "‡∞Æ‡±Ä AI-‡∞∂‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞≤ ‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£ ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞°‡±Å",
        followUp: "‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü‡∞≤ ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Æ‡∞∞‡±á‡∞¶‡±à‡∞®‡∞æ ‡∞§‡±Ü‡∞≤‡±Å‡∞∏‡±Å‡∞ï‡±ã‡∞µ‡∞æ‡∞≤‡∞®‡±Å‡∞ï‡±Å‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞æ?",
        emptyFields: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞™‡∞Ç‡∞ü ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
        upload: "‡∞™‡∞Ç‡∞ü ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        predict: "‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ ‡∞µ‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
        processing: "‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡∞ø‡∞Ç‡∞ó‡±ç...",
        examplePhrases: "‡∞à ‡∞µ‡∞ø‡∞ß‡∞Æ‡±à‡∞® ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø",
        example1: "‡∞®‡∞æ ‡∞ü‡∞Æ‡∞æ‡∞ü‡∞æ ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞Ü‡∞ï‡±Å‡∞≤‡±Å ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞∞‡∞Ç‡∞ó‡±Å‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø",
        example2: "‡∞ó‡±ã‡∞ß‡±Å‡∞Æ ‡∞Ü‡∞ï‡±Å‡∞≤‡∞™‡±à ‡∞ó‡±ã‡∞ß‡±Å‡∞Æ ‡∞Æ‡∞ö‡±ç‡∞ö‡∞≤‡±Å",
        imageUploaded: "üì∏ ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞Ç ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø, ‡∞™‡∞Ç‡∞ü ‡∞Ü‡∞∞‡±ã‡∞ó‡±ç‡∞Ø‡∞Ç ‡∞µ‡∞ø‡∞∂‡±ç‡∞≤‡±á‡∞∑‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",
        errorProcessing: "‚ùå ‡∞Æ‡±Ä ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        errorImage: "‚ùå ‡∞ö‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞≤‡±ã ‡∞≤‡±ã‡∞™‡∞Ç. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
        unexpectedError: "‡∞∏‡∞∞‡±ç‡∞µ‡∞∞‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞Ö‡∞®‡±Ç‡∞π‡±ç‡∞Ø ‡∞™‡±ç‡∞∞‡∞§‡∞ø‡∞∏‡±ç‡∞™‡∞Ç‡∞¶‡∞® ‡∞´‡∞æ‡∞∞‡±ç‡∞Æ‡∞æ‡∞ü‡±ç.",
        suggestions: [
          "‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã: ‡∞ó‡±ã‡∞ß‡±Å‡∞Æ ‡∞Æ‡∞ö‡±ç‡∞ö‡∞≤‡∞§‡±ã ‡∞™‡∞∏‡±Å‡∞™‡±Å ‡∞Ü‡∞ï‡±Å‡∞≤‡±Å",
          "‡∞µ‡∞∞‡∞ø: ‡∞Ü‡∞ï‡±Å‡∞≤‡∞™‡±à ‡∞§‡±Ü‡∞≤‡±ç‡∞≤‡∞ü‡∞ø ‡∞™‡±ä‡∞°‡∞ø ‡∞™‡∞¶‡∞æ‡∞∞‡±ç‡∞•‡∞Ç",
          "‡∞ó‡±ã‡∞ß‡±Å‡∞Æ: ‡∞ï‡∞æ‡∞°‡∞≤‡∞™‡±à ‡∞®‡∞æ‡∞∞‡∞ø‡∞Ç‡∞ú ‡∞∞‡∞Ç‡∞ó‡±Å ‡∞¨‡±ä‡∞¨‡±ç‡∞¨‡∞≤‡±Å",
          "‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®: ‡∞Ü‡∞ï‡±Å‡∞≤‡∞™‡±à ‡∞¨‡±Ç‡∞°‡∞ø‡∞¶-‡∞§‡±Ü‡∞≤‡±Å‡∞™‡±Å ‡∞™‡±Å‡∞Ç‡∞°‡±ç‡∞≤‡±Å"
        ],
        diagnosis: {
          basedOnSymptoms: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞≤‡∞ï‡±ç‡∞∑‡∞£‡∞æ‡∞≤ ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ",
          forCrop: "‡∞Æ‡±Ä {crop} ‡∞™‡∞Ç‡∞ü‡∞ï‡±Å",
          atLocation: "{location} ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç‡∞≤‡±ã",
          mightBeAffected: "‡∞á‡∞¶‡∞ø {disease}‡∞§‡±ã ‡∞™‡±ç‡∞∞‡∞≠‡∞æ‡∞µ‡∞ø‡∞§‡∞Æ‡±à ‡∞â‡∞Ç‡∞°‡∞µ‡∞ö‡±ç‡∞ö‡±Å",
          severity: "‡∞§‡±Ä‡∞µ‡±ç‡∞∞‡∞§",
          recommendedActions: "‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡∞∏‡±Å ‡∞ö‡±á‡∞∏‡∞ø‡∞® ‡∞ö‡∞∞‡±ç‡∞Ø‡∞≤‡±Å",
          prevention: "‡∞®‡∞ø‡∞µ‡∞æ‡∞∞‡∞£",
          treatment: "‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏",
          organicOptions: "‡∞∏‡±á‡∞Ç‡∞¶‡±ç‡∞∞‡±Ä‡∞Ø ‡∞ö‡∞ø‡∞ï‡∞ø‡∞§‡±ç‡∞∏",
          noDetailedAdvice: "‡∞µ‡∞ø‡∞µ‡∞∞‡∞£‡∞æ‡∞§‡±ç‡∞Æ‡∞ï ‡∞∏‡∞≤‡∞π‡∞æ ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞¶‡±Å",
          genericCrop: "‡∞™‡∞Ç‡∞ü",
          information: "‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç",
          consultExperts: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞®‡∞ø‡∞∞‡±ç‡∞¶‡∞ø‡∞∑‡±ç‡∞ü ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ó‡∞¶‡∞∞‡±ç‡∞∂‡∞ï‡∞§‡±ç‡∞µ‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤‡∞®‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.",
          genericDisease: "‡∞í‡∞ï ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï ‡∞∞‡±ã‡∞ó‡∞Ç"
        },
        userInputPrefix: {
          my: "‡∞®‡∞æ",
          plants: "‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤",
          have: "‡∞≤‡±ã ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø"
        }
      }
    };

    const chatContainer = document.getElementById('chatContainer');
    const suggestionBoxes = document.getElementById('suggestionBoxes');
    const userInput = document.getElementById('userInput');
    const headerSubtitle = document.getElementById('headerSubtitle');
    const clearText = document.getElementById('clearText');
    const uploadText = document.getElementById('uploadText');
    const predictText = document.getElementById('predictText');
    const submitButton = document.getElementById('submitButton');
    const predictBtn = document.getElementById('predictBtn');

    function addMessage(html, isUser = false, isError = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = isUser ? 'message user-message' : `message bot-message ${isError ? 'error-message' : 'success-message'}`;
      messageDiv.innerHTML = html;
      chatContainer.appendChild(messageDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message bot-message';
      typingDiv.id = 'typingIndicator';
      typingDiv.innerHTML = '<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
      chatContainer.appendChild(typingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideTypingIndicator() {
      const el = document.getElementById('typingIndicator');
      if (el) el.remove();
    }

    function renderSuggestions() {
      suggestionBoxes.innerHTML = '';
      const t = translations[userLanguage];
      const suggestions = t.suggestions;
      
      suggestions.forEach(suggestion => {
        const parts = suggestion.split(':');
        const crop = parts[0].trim();
        const symptom = parts[1].trim();
        const div = document.createElement('div');
        div.className = 'suggestion-box';
        div.textContent = suggestion;
        div.onclick = () => {
          // Use translated prefixes based on selected language
          const prefix = t.userInputPrefix;
          userInput.value = `${prefix.my} ${crop} ${prefix.plants} ${prefix.have} ${symptom}`;
          document.getElementById('suggestionsContainer').style.display = 'none';
          userInput.focus();
        };
        suggestionBoxes.appendChild(div);
      });
    }

    function showInitialBotMessage() {
      const t = translations[userLanguage];
      headerSubtitle.textContent = t.headerSubtitle;
      clearText.textContent = t.buttons.clear;
      userInput.placeholder = t.placeholders.symptom;
      uploadText.textContent = t.upload;
      predictText.textContent = t.predict;
      renderSuggestions();
      addMessage(`<p>${t.greeting}</p><p><strong>${t.examplePhrases}:</strong> "${t.example1}" or "${t.example2}"</p>`);
    }

    function clearChat() {
      chatContainer.innerHTML = '';
      document.getElementById('suggestionsContainer').style.display = 'block';
      showInitialBotMessage();
    }

    function changeLanguage() {
      userLanguage = document.getElementById('languageSelect').value;
      clearChat();
    }

    // Enhanced API response handler with better translation support
    function handleAPIResponse(data, userInputText = '', isImageResponse = false) {
      if (data.advice) {
        // Parse the structured advice from backend
        const structuredAdvice = parseStructuredAdvice(data.advice, userInputText, isImageResponse);
        addMessage(structuredAdvice);
      } else if (data.message) {
        addMessage(data.message, false, data.status === 'error');
      } else if (data.error) {
        addMessage(data.error, false, true);
      } else {
        const t = translations[userLanguage];
        addMessage(t.unexpectedError, false, true);
      }
    }

    // Parse and structure the advice with proper localization
    function parseStructuredAdvice(adviceText, userInputText, isImageResponse = false) {
      const t = translations[userLanguage].diagnosis;
      
      // Extract location from user input if present
      const locationMatch = userInputText.match(/\b(at|in|near)\s+([^,.]+)/i);
      const location = locationMatch ? locationMatch[2] : '';
      
      // Parse the backend response to extract structured information
      let crop = t.genericCrop; // Use generic crop name in selected language
      let disease = t.genericDisease;
      let severity = '';
      let prevention = '';
      let treatment = '';
      let organic = '';
      
      // Extract crop from user input first (only for text input, not image)
      if (!isImageResponse) {
        const cropMatch = userInputText.match(/\b(tomato|rice|wheat|corn|maize|potato|cotton|soybean|‡§ó‡•á‡§π‡•Ç‡§Ç|‡§ü‡§Æ‡§æ‡§ü‡§∞|‡§ö‡§æ‡§µ‡§≤|‡§Æ‡§ï‡•ç‡§ï‡§æ|‡∞ó‡±ã‡∞ß‡±Å‡∞Æ|‡∞µ‡∞∞‡∞ø|‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã|‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®)\b/i);
        if (cropMatch) {
          // Translate crop name if it's in another language
          crop = translateCropName(cropMatch[0]);
        }
      }
      
      // Parse the backend advice text
      const severityMatch = adviceText.match(/Severity:\s*([^\.]+)/i);
      if (severityMatch) severity = severityMatch[1].trim();
      
      const preventionMatch = adviceText.match(/Recommended actions:\s*([^\.]+)/i) || adviceText.match(/Prevention:\s*([^\.]+)/i);
      if (preventionMatch) prevention = preventionMatch[1].trim();
      
      const treatmentMatch = adviceText.match(/Treatment:\s*([^\.]+)/i);
      if (treatmentMatch) treatment = treatmentMatch[1].trim();
      
      const organicMatch = adviceText.match(/Organic options:\s*([^\.]+)/i);
      if (organicMatch) organic = organicMatch[1].trim();
      
      // Disease extraction (improved)
      const diseaseMatch = adviceText.match(/affected by\s+([^\.\(]+)/i) || 
                          adviceText.match(/might be\s+([^\.]+)/i) ||
                          adviceText.match(/suggests the crop might be affected by\s+([^\.]+)/i);
      if (diseaseMatch) disease = diseaseMatch[1].trim();
      
      // Check for "no detailed advice" case
      const noAdviceMatch = adviceText.match(/no detailed advice is available/i);
      
      // Build structured response in the user's language
      let structuredHTML = '';
      
      // Main diagnosis line
      structuredHTML += `<p><strong>${t.basedOnSymptoms} `;
      structuredHTML += `${t.forCrop.replace('{crop}', crop)}`;
      if (location) {
        structuredHTML += ` ${t.atLocation.replace('{location}', location)}`;
      }
      
      if (noAdviceMatch) {
        structuredHTML += `, ${t.noDetailedAdvice}.</strong></p>`;
      } else {
        structuredHTML += `, ${t.mightBeAffected.replace('{disease}', disease)}.</strong></p>`;
      }
      
      // If no detailed advice, show a generic message
      if (noAdviceMatch) {
        structuredHTML += `
          <div class="advice-section">
            <div class="advice-title">
              <i class="fas fa-info-circle"></i>
              ${t.information}
            </div>
            <div>${t.noDetailedAdvice}. ${t.consultExperts}</div>
          </div>
        `;
        return structuredHTML;
      }
      
      // Severity section
      if (severity && severity !== 'N/A') {
        structuredHTML += `
          <div class="advice-section">
            <div class="advice-title">
              <i class="fas fa-exclamation-triangle"></i>
              ${t.severity}: ${severity}
            </div>
          </div>
        `;
      }
      
      // Prevention section
      if (prevention && prevention !== 'N/A') {
        structuredHTML += `
          <div class="advice-section">
            <div class="advice-title">
              <i class="fas fa-shield-alt"></i>
              ${t.prevention}
            </div>
            <div>${prevention}</div>
          </div>
        `;
      }
      
      // Treatment section
      if (treatment && treatment !== 'N/A') {
        structuredHTML += `
          <div class="advice-section">
            <div class="advice-title">
              <i class="fas fa-stethoscope"></i>
              ${t.treatment}
            </div>
            <div>${treatment}</div>
          </div>
        `;
      }
      
      // Organic treatment section
      if (organic && organic !== 'N/A' && organic !== 'Not specified') {
        structuredHTML += `
          <div class="advice-section">
            <div class="advice-title">
              <i class="fas fa-leaf"></i>
              ${t.organicOptions}
            </div>
            <div>${organic}</div>
          </div>
        `;
      }
      
      return structuredHTML;
    }

    // Helper function to translate crop names
    function translateCropName(cropName) {
      const cropTranslations = {
        // English to other languages
        'tomato': { en: 'tomato', hi: '‡§ü‡§Æ‡§æ‡§ü‡§∞', te: '‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã' },
        'wheat': { en: 'wheat', hi: '‡§ó‡•á‡§π‡•Ç‡§Ç', te: '‡∞ó‡±ã‡∞ß‡±Å‡∞Æ' },
        'rice': { en: 'rice', hi: '‡§ö‡§æ‡§µ‡§≤', te: '‡∞µ‡∞∞‡∞ø' },
        'corn': { en: 'corn', hi: '‡§Æ‡§ï‡•ç‡§ï‡§æ', te: '‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®' },
        'maize': { en: 'maize', hi: '‡§Æ‡§ï‡•ç‡§ï‡§æ', te: '‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®' },
        'potato': { en: 'potato', hi: '‡§Ü‡§≤‡•Ç', te: '‡∞¨‡∞Ç‡∞ó‡∞æ‡∞≥‡∞¶‡±Å‡∞Ç‡∞™' },
        'cotton': { en: 'cotton', hi: '‡§ï‡§™‡§æ‡§∏', te: '‡∞™‡∞§‡±ç‡∞§‡∞ø' },
        'soybean': { en: 'soybean', hi: '‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®', te: '‡∞∏‡±ã‡∞Ø‡∞æ‡∞¨‡±Ä‡∞®‡±ç' },
        
        // Hindi to other languages
        '‡§ü‡§Æ‡§æ‡§ü‡§∞': { en: 'tomato', hi: '‡§ü‡§Æ‡§æ‡§ü‡§∞', te: '‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã' },
        '‡§ó‡•á‡§π‡•Ç‡§Ç': { en: 'wheat', hi: '‡§ó‡•á‡§π‡•Ç‡§Ç', te: '‡∞ó‡±ã‡∞ß‡±Å‡∞Æ' },
        '‡§ö‡§æ‡§µ‡§≤': { en: 'rice', hi: '‡§ö‡§æ‡§µ‡§≤', te: '‡∞µ‡∞∞‡∞ø' },
        '‡§Æ‡§ï‡•ç‡§ï‡§æ': { en: 'corn', hi: '‡§Æ‡§ï‡•ç‡§ï‡§æ', te: '‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®' },
        '‡§Ü‡§≤‡•Ç': { en: 'potato', hi: '‡§Ü‡§≤‡•Ç', te: '‡∞¨‡∞Ç‡∞ó‡∞æ‡∞≥‡∞¶‡±Å‡∞Ç‡∞™' },
        '‡§ï‡§™‡§æ‡§∏': { en: 'cotton', hi: '‡§ï‡§™‡§æ‡§∏', te: '‡∞™‡∞§‡±ç‡∞§‡∞ø' },
        '‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®': { en: 'soybean', hi: '‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®', te: '‡∞∏‡±ã‡∞Ø‡∞æ‡∞¨‡±Ä‡∞®‡±ç' },
        
        // Telugu to other languages
        '‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã': { en: 'tomato', hi: '‡§ü‡§Æ‡§æ‡§ü‡§∞', te: '‡∞ü‡∞Æ‡∞æ‡∞ü‡±ã' },
        '‡∞ó‡±ã‡∞ß‡±Å‡∞Æ': { en: 'wheat', hi: '‡§ó‡•á‡§π‡•Ç‡§Ç', te: '‡∞ó‡±ã‡∞ß‡±Å‡∞Æ' },
        '‡∞µ‡∞∞‡∞ø': { en: 'rice', hi: '‡§ö‡§æ‡§µ‡§≤', te: '‡∞µ‡∞∞‡∞ø' },
        '‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®': { en: 'corn', hi: '‡§Æ‡§ï‡•ç‡§ï‡§æ', te: '‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞ú‡±ä‡∞®‡±ç‡∞®' },
        '‡∞¨‡∞Ç‡∞ó‡∞æ‡∞≥‡∞¶‡±Å‡∞Ç‡∞™': { en: 'potato', hi: '‡§Ü‡§≤‡•Ç', te: '‡∞¨‡∞Ç‡∞ó‡∞æ‡∞≥‡∞¶‡±Å‡∞Ç‡∞™' },
        '‡∞™‡∞§‡±ç‡∞§‡∞ø': { en: 'cotton', hi: '‡§ï‡§™‡§æ‡§∏', te: '‡∞™‡∞§‡±ç‡∞§‡∞ø' },
        '‡∞∏‡±ã‡∞Ø‡∞æ‡∞¨‡±Ä‡∞®‡±ç': { en: 'soybean', hi: '‡§∏‡•ã‡§Ø‡§æ‡§¨‡•Ä‡§®', te: '‡∞∏‡±ã‡∞Ø‡∞æ‡∞¨‡±Ä‡∞®‡±ç' }
      };
      
      const lowerCrop = cropName.toLowerCase();
      if (cropTranslations[lowerCrop] && cropTranslations[lowerCrop][userLanguage]) {
        return cropTranslations[lowerCrop][userLanguage];
      }
      
      return cropName; // Return original if no translation found
    }

    // Text diagnosis form handler
    document.getElementById('diagnosisForm').addEventListener('submit', async e => {
      e.preventDefault();
      const text = userInput.value.trim();
      const t = translations[userLanguage];
      
      if (!text) { 
        addMessage(t.emptyFields, false, true); 
        return; 
      }
      
      // Disable form during request
      submitButton.disabled = true;
      submitButton.classList.add('processing');
      userInput.disabled = true;
      
      addMessage(`<strong>You:</strong> ${text}`, true);
      document.getElementById('suggestionsContainer').style.display = 'none';
      showTypingIndicator();
      
      try {
        const res = await fetch('/diagnose', { 
          method: 'POST', 
          headers: { 'Content-Type': 'application/json' }, 
          body: JSON.stringify({ text, lang: userLanguage }) 
        });
        
        hideTypingIndicator();
        const data = await res.json();
        
        if (res.ok) {
          handleAPIResponse(data, text, false);
          userInput.value = '';
          
          // Show follow-up message
          setTimeout(() => {
            showTypingIndicator();
            setTimeout(() => {
              hideTypingIndicator();
              addMessage(t.followUp);
            }, 800);
          }, 400);
        } else {
          handleAPIResponse(data);
        }
      } catch (err) { 
        hideTypingIndicator();
        console.error('Diagnosis error:', err);
        addMessage(t.errorProcessing, false, true);
      } finally {
        // Re-enable form
        submitButton.disabled = false;
        submitButton.classList.remove('processing');
        userInput.disabled = false;
        userInput.focus();
      }
    });

    // Image upload and prediction
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');

    imageInput.addEventListener('change', () => {
      const file = imageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => { 
          imagePreview.src = e.target.result; 
          imagePreview.style.display = 'block'; 
          predictBtn.disabled = false; 
        };
        reader.readAsDataURL(file);
      }
    });

    predictBtn.addEventListener('click', async () => {
      if (!imageInput.files[0]) return;

      const t = translations[userLanguage];
      
      // Disable during processing
      predictBtn.disabled = true;
      predictBtn.classList.add('processing');
      predictText.textContent = t.processing;
      imageInput.disabled = true;

      addMessage(`<i>${t.imageUploaded}</i>`, true);
      showTypingIndicator();

      const formData = new FormData();
      formData.append('file', imageInput.files[0]);
      formData.append('lang', userLanguage);

      try {
        const res = await fetch('/predict', { method: 'POST', body: formData });
        hideTypingIndicator();
        const data = await res.json();
        
        if (res.ok) {
          // For image responses, pass empty user input to avoid crop duplication
          handleAPIResponse(data, '', true);
          
          // Show follow-up message
          setTimeout(() => {
            showTypingIndicator();
            setTimeout(() => {
              hideTypingIndicator();
              addMessage(t.followUp);
            }, 800);
          }, 400);
        } else {
          handleAPIResponse(data);
        }
      } catch (err) {
        hideTypingIndicator();
        console.error('Prediction error:', err);
        addMessage(t.errorImage, false, true);
      } finally {
        // Reset image upload
        imageInput.value = '';
        imagePreview.style.display = 'none';
        predictBtn.disabled = false;
        predictBtn.classList.remove('processing');
        predictText.textContent = t.predict;
        imageInput.disabled = false;
      }
    });

    // Initialize the chat
    showInitialBotMessage();

    // Simple session check (basic implementation)
    if (!document.cookie.includes('session') && window.location.pathname !== '/login') {
      console.log('No session detected - user should be redirected to login');
    }
  </script>
</body>
</html>